class e{constructor(e){this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),this.setValue(Math.random()>.1?2:4),e.append(this.tileElement)}setXY(e,t){this.x=e,this.y=t,this.tileElement.style.setProperty("--x",e),this.tileElement.style.setProperty("--y",t)}setValue(e){this.value=e,this.tileElement.textContent=e,this.tileElement.classList.add(`tile--${e}`)}getValue(){return this.value}removeFromField(){this.tileElement.remove()}}class t{constructor(e,t,l){let s=document.createElement("div");s.classList.add("field-cell"),e.append(s),this.x=t,this.y=l}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}unlinkTile(){this.linkedTile=null}isEmpty(){return!this.linkedTile}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}unlinkTileForMerge(){this.linkedTileForMerge=null}hasTileForMerge(){return!!this.linkedTileForMerge}canAccept(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}mergeTiles(){this.linkedTile.setValue(this.linkedTile.value+this.linkedTileForMerge.value),this.linkedTileForMerge.removeFromField(),this.unlinkTileForMerge()}getValue(){return this.linkedTile.getValue()}}const l=document.getElementById("game-field"),s=new class{constructor(e){this.cells=[];for(let l=0;l<16;l++)this.cells.push(new t(e,l%4,Math.floor(l/4)));this.cellsGrouppedByColumns=this.groupCellsByColumn(),this.cellsGrouppedByReversedColumns=this.groupCellsByColumn().map(e=>[...e].reverse()),this.cellsGrouppedByRows=this.groupCellsByRow(),this.cellsGrouppedByReversedRows=this.groupCellsByRow().map(e=>[...e].reverse())}getRandomEmptyCell(){let e=this.cells.filter(e=>e.isEmpty()),t=Math.floor(Math.random()*e.length);return e[t]}groupCellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}groupCellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}}(l),i=document.getElementById("button-start");i.addEventListener("click",function e(){o(),document.getElementById("message-start").classList.add("hidden"),i.classList.remove("start"),i.innerHTML="Restart",i.classList.add("restart"),i.removeEventListener("click",e),i.addEventListener("click",o)});let n=0;const r=document.getElementById("score");function o(){s.cells.forEach(e=>{e.isEmpty()||(e.linkedTile.removeFromField(),e.unlinkTile())}),s.getRandomEmptyCell().linkTile(new e(l)),s.getRandomEmptyCell().linkTile(new e(l)),d(),n=0,r.innerHTML=n,document.getElementById("message-lose").classList.add("hidden"),document.getElementById("message-win").classList.add("hidden")}function d(){window.addEventListener("keydown",u,{once:!0})}function u(t){switch(t.key){case"ArrowUp":if(!a()){d();return}c(s.cellsGrouppedByColumns);break;case"ArrowDown":if(!m()){d();return}c(s.cellsGrouppedByReversedColumns);break;case"ArrowLeft":if(!h()){d();return}c(s.cellsGrouppedByRows);break;case"ArrowRight":if(!p()){d();return}c(s.cellsGrouppedByReversedRows);break;default:d();return}let i=new e(l);if(s.getRandomEmptyCell().linkTile(i),!a()&&!m()&&!h()&&!p()){document.getElementById("message-lose").classList.remove("hidden");return}d()}function c(e){e.forEach(e=>(function(e){for(let t=1;t<e.length;t++){let l;if(e[t].isEmpty())continue;let s=e[t],i=t-1;for(;i>=0&&e[i].canAccept(s.linkedTile);)l=e[i],i--;l&&(l.isEmpty()?l.linkTile(s.linkedTile):l.linkTileForMerge(s.linkedTile),s.unlinkTile())}})(e)),s.cells.forEach(e=>{e.hasTileForMerge()&&(e.mergeTiles(),n+=e.getValue(),r.innerHTML=n,2048===e.getValue()&&(document.getElementById("message-win").classList.remove("hidden"),window.removeEventListener("keydown")))})}function a(){return y(s.cellsGrouppedByColumns)}function m(){return y(s.cellsGrouppedByReversedColumns)}function h(){return y(s.cellsGrouppedByRows)}function p(){return y(s.cellsGrouppedByReversedRows)}function y(e){return e.some(e=>e.some((t,l)=>!(0===l||t.isEmpty())&&e[l-1].canAccept(t.linkedTile)))}
//# sourceMappingURL=index.f9ed1e1f.js.map
